# Hello Web Server

## 7.9.2024

## x) Lue ja tiivistä

**Name-based Virtual Host Support (lähde: The Apache Software Foundation, https://httpd.apache.org/docs/2.4/vhosts/name-based.html)**

- Nimipohjainen virtual hosting on yksinkertaisempi tapa kuin IP-pohjainen, sillä nimipohjaisessa hostingissa useat eri verkkosivut voivat käyttää samaa IP-osoitetta, koska client ilmoittaa hostin nimen osana HTTP-otsikkoa.
  IP-pohjaisessa jokaisella verkkosivulla tulee olla oma IP-osoite.

- Nimipohjaisessa virtual hostingissa tehdään ensin IP-pohjainen selvitys, jonka mukaan palvelin osaa valita oikean hostin IP-osoitteen perusteella. Mikäli samaan IP-osoitteeseen on liitetty useita eri verkkosivuja,
  vertaa palvelin pyynnössä ilmoitettua ServerNamea ja ServerAliasta. Näiden perusteella palvelin osaa valita oikean sivun näytettäväksi, vaikka IP-osoite olisikin sama.

- Jokaiselle sivulle luodaan oma VirtualHost -lohko, johon määritellään ServerName, eli se nimi jota sivusta halutaan käyttää, sekä DocumentRoot, eli se hakemisto jossa sivusto tiedostoina sijaitsee.


**Name Based Virtual Hosts on Apache - Multiple Websites to Single IP Address (lähde: Tero Karvinen, https://terokarvinen.com/2018/04/10/name-based-virtual-hosts-on-apache-multiple-websites-to-single-ip-address/)**

- Apachessa nimipohjaisen virtual hostingin käyttö aloitetaan konfiguroimalla nettiserveri korvaamalla oletusnettisivu.

- Adminina lisätään nimipohjainen virtual host lisäämällä conf -tiedostoon VirtualHost -lohko tietoineen, ja käynnnistämällä Apache uudelleen.

- Verkkosivu voidaan luoda kuitenkin ihan tavallisena käyttäjänä.

## a) Apachen testaus

> Klo 20:45

Aloitin käynnistämällä virtuaalikoneeni ja ajamalla terminaalissa jo tutuksi tulleen `sudo apt-get update`. Siinä ei ongelmia ilmennyt.

Ehdin viime luennolla jo asentamaan Apachen, joten seuraavaksi tarkistin vieläkö weppipalvelin vastaa localhostista, ja hyvin vastasi, esiin tuli Apache2 Debianin oletussivu. (Kuvankaappauksessa vain alkuosa terminaalin tuloksesta)

![image](https://github.com/user-attachments/assets/a9c9870c-e72d-407c-bad9-09e7df31f307)

Testasin saman vielä nettiselaimesta, ja ei ongelmaa. (Kuvankaappauksessa vain alkuosa nettisivusta)

![image](https://github.com/user-attachments/assets/ba158b7b-8117-4aba-89e9-40371ebb8dde)

## b) Lokit sivun lataamisesta

> Klo 20:54

Seuraavaksi etsin hakemistosta kansion, johon Apache tekee lokeja. Yritin ulkomuistista muistaa komennon, jolla pääsee suoraan oikeaan kansioon, mutta sehän ei onnistunutkaan, joten liikuin kansio kerrallaan. Normaalina käyttäjänä apache2 -kansioon ei ollutkaan mitään asiaa.

![image](https://github.com/user-attachments/assets/9fb66fa3-171b-49a7-a2fc-a272cb240b1c)

Muutaman ulkomuistista muistellun ja yritetyn järkeilyn kautta kokeiltujen komentojen ja nopean Googlettelun jälkeen oli aika kysyä apua ChatGPT:ltä. Sieltä saaduilla avuilla ja viimein omia luennolla tehtyjä muistiinpanoja lukemalla löysin komennon, jolla pääsin käsiksi kansion sisältöön. 

![image](https://github.com/user-attachments/assets/fd706b47-4064-4f6c-b8a5-d4b50d0c9b88)

Arvelin infoa löytyvän access.log -tiedostosta, ja seuraavaksi yritin päästä siihen käsiksi. Taas muutaman hutikomennon jälkeen sain listauksen näkyviin.

![image](https://github.com/user-attachments/assets/992594b7-76eb-4cbf-94a3-d67807dc1202)

Avasin lokin vielä microssa, jotta saisin rivinumerot näkyville (en muistanut sitä komentoa joka olisi ne suoraan terminaalissa näyttänyt).

![image](https://github.com/user-attachments/assets/1290c507-c766-47e4-9f29-73841df3c785)

Suoriltaan en osannut yhtäkään riviä analysoida, joten ensin oli etsittävä tietoa, ja sopivan näköiset artikkelit löytyivätkin sumo logic sekä catalyst2 -sivuilta (lähteet: Scott Fitzpatrick, https://www.sumologic.com/blog/apache-access-log/ & catalyst2, https://www.catalyst2.com/knowledgebase/cpanel/understanding-apache-access-logs/).

Lähdin ensin purkamaan ensimmäisen rivin sisältöä.

- Rivillä ensimmäisenä oleva **127.0.0.1** on pyynnön tehneen clientin IP-osoite.
  
- IP-osoitteen jälkeen tuleva ensimmäinen viiva pitää clientin "identiteetin" paikkaa, ja siihen palautuukin pyynnöissä usein pelkkä viiva.
  
- Toisen viivan paikalla tulisi olla pyynnön tehneen käyttäjän id, mutta minulla se on tyhjä. Selvittelyn jälkeen löysin tiedon, että koska tiedosto, jota hain ei ollut salasanasuojattu, kenttään tulostuu pelkkä viiva. (lähde: The Apache Software Foundation, https://httpd.apache.org/docs/current/logs.html)
  
- Seuraavana oleva **[04/Sep/2024:20:01:22 +0300]** kertoo pyynnön päivämäärän ja kellonajan. Tämä ei mielestäni tosin täsmännyt, jos olin avannut koko virtuaalikoneen vasta klo 21:45. Virtuaalikoneen kello on kuitenkin oikeassa, enkä selvittänyt asiaa tässä kohtaa pidemmälle.

- Seuraava kohta on hieman erilainen eri riveillä, mutta ensimmäisellä rivillä se on muodossa **"GET / HTTP/1.1"**. Tässä GET kertoo mitä pyyntöä on käytetty, ensimmäisen kauttaviivan jälkeen kerrottaisiin mitä resurssia on pyydetty, ja HTTP/1.1 kertoo mitä protokollaa on käytetty.

- Seuraavana jokaisella rivillä toistuu **200**, joka on http-pyynnön vastauskoodi. 200 on OK.

- Seuraavat numerot **10956** kertovat clientille palautetun objektin koon bitteinä.

- Seuraava kohta **"-"** kertoo miltä sivulta kyseiseen resurssin pyyntö on tullut. Kolmannella rivillä esimerkiksi on haettu logo, ja sitä on pyydetty avaamalla localhost -sivu.

- Seuraava kohta **"curl/7.88.1"** kertoo "User Agent"in, eli sen mistä resurssiin ollaan tultu. Testasin toimintaa sekä curlilla että nettiselaimella, ja siksi eri riveillä on tässä kohtaa eri tietoa. Jos kyseessä selain, kohta kertoo mikä selain on kyseessä sekä millä käyttöjärjestelmällä selainta käytetään. catalyst2 -sivuilta bongasin tiedon, että tätä kohtaa voi tosin itse muokata halutessaan, sillä Apache loggaa tiedot niin kuin käyttäjä itse sen määrittelee, eli tähän kenttään ei välttämättä kannata luottaa sokeasti.

- 
















